# 后端开发注意事项

## 已有服务说明

后端源码集中在src\main\java\com\SmartHire中，各模块职责如下：

* `userAuthService`：用户登录模块，包含用户注册登录、用户基本信息编写等功能
* `seekerService`：求职者信息模块，包含求职者个人信息填写、在线简历填写、上传附件简历等功能
* `hrService`：HR信息模块，包含HR个人信息填写、岗位发布、编辑等功能
* `recruitmentService`：招聘模块，包含用户投递简历、HR查看投递记录等功能（开发中）
* `messageService`：沟通模块，包含用户和HR的沟通功能
* `common`：公共类，包含异常处理、请求拦截、jwt解析、OSS对象存储等功能

后续计划添加：

* `recommendService`：推荐算法模块，主要包含向求职者推荐岗位、向HR推荐人才功能
* `aiService`：ai应用模块，主要包含对LLM的集成应用

# 后续开发要求

## 一、微服务迁移

目前项目为单体服务。为方便以后迁移成微服务结构，需要制定一些规范

### 1.模块化开发

用文件夹区分不同的服务模块，保持现有文件夹结构

### 2.不要跨模块访问数据库

反例：

```java
jobService.getJobById()
userMapper.findById()        // Job模块直接访问用户表

```

对于需要进行跨模块访问数据库的地方：

* 在 `common\api`中创建**被访问模块的Api文件**（比如要访问userAuth模块，就创建UserAuthApi.java接口文件）
* 在被访问模块的 `service\impl`文件夹里面，创建ApiImpl文件（比如要访问userAuth模块，就创建UserAuthApiImpl.java文件）
* 开发中提前预计需要跨模块访问的内容，即使和相关负责人沟通（比如A需要访问B模块，提前告知B提供接口）

### 3.业务之间的通信使用接口，而不是直接 new Service

反例：`new ResumeService().getResume(id)`

正例：

```java
@Autowired
ResumeService resumeService;
```

### 4.公共代码放在common模块

## 二、代码扫描

CI流水线配置中添加了代码扫描功能，用于统一代码风格和控制代码质量，具体工具说明如下

### Spotless

* 自动格式化代码的工具
* 检查格式（不修改：`mvn spotless:check`）
* 自动修复格式：`mvn spotless:apply`

### PMD

* 静态代码分析。检查潜在的 Bug、空指针风险、复杂度过高、死代码等
* 执行检查：`mvn pmd:check`
  * 如果有错误，详细报告文件会在 `SmartHire_Backend\target\pmd`文件夹中
  * 可以直接把报告丢给ai让他帮你改（bushi）

### SpotBugs+FindSecBugs

* 用于检测潜在 bug、空指针、线程问题等
* 检查：`mvn clean verify`

### 后端开发在 PR 前需要做什么？

#### 方式一：使用一键检查脚本（推荐）

在 `SmartHire_Backend` 目录下双击运行 `check.bat`，脚本会自动执行所有检查步骤：

1. 格式化代码（`mvn spotless:apply`）
2. 检查代码格式（`mvn spotless:check`）
3. 运行单元测试（`mvn test`）
4. PMD 静态代码分析（`mvn pmd:check`）
5. SpotBugs+FindSecBugs 检查（`mvn clean verify`）

如果所有检查通过，代码即可提交 PR。

#### 方式二：手动执行命令

在本地提交 PR 之前，请在 `SmartHire_Backend` 目录依次执行以下命令，确保代码风格和静态检查通过：

1. **格式化代码**
   * 自动修复格式：`mvn spotless:apply`
   * 确认无格式问题：`mvn spotless:check`
2. **运行单元测试**
   * `mvn test`
3. **静态代码扫描**
   * PMD：`mvn pmd:check`
   * SpotBugs+FindSecBugs（会同时跑测试、PMD、SpotBugs 等）：`mvn clean verify`
