# 数据库修改说明 - 公司管理员和两级审核功能

## 修改日期
2025-12-13

## 修改概述
为支持公司管理员角色和两级审核流程（公司审核 → 系统审核），对数据库进行了以下修改。

---

## 一、hr_info 表修改

### 1.1 新增字段
- **字段名**: `is_company_admin`
- **类型**: `TINYINT`
- **默认值**: `0`
- **注释**: 是否为公司管理员：0-否 1-是
- **位置**: 在 `work_phone` 字段之后

### 1.2 新增索引
- **索引名**: `idx_company_admin`
- **字段**: `company_id`, `is_company_admin`
- **用途**: 优化按公司ID和公司管理员状态查询

---

## 二、job_audit_record 表修改

### 2.1 新增字段（公司审核相关）

1. **company_audit_status**
   - 类型: `VARCHAR(20)`
   - 注释: 公司审核状态: pending-待审核 approved-已通过 rejected-已拒绝 modified-需修改
   - 位置: 在 `audit_status` 字段之后

2. **company_auditor_id**
   - 类型: `BIGINT`
   - 注释: 公司审核员ID
   - 位置: 在 `company_audit_status` 字段之后

3. **company_auditor_name**
   - 类型: `VARCHAR(50)`
   - 注释: 公司审核员姓名
   - 位置: 在 `company_auditor_id` 字段之后

4. **company_audited_at**
   - 类型: `DATETIME`
   - 注释: 公司审核时间
   - 位置: 在 `company_auditor_name` 字段之后

### 2.2 新增字段（系统审核相关）

5. **system_audit_status**
   - 类型: `VARCHAR(20)`
   - 注释: 系统审核状态: pending-待审核 approved-已通过 rejected-已拒绝 modified-需修改
   - 位置: 在 `company_audited_at` 字段之后

6. **system_auditor_id**
   - 类型: `BIGINT`
   - 注释: 系统审核员ID
   - 位置: 在 `system_audit_status` 字段之后

7. **system_auditor_name**
   - 类型: `VARCHAR(50)`
   - 注释: 系统审核员姓名
   - 位置: 在 `system_auditor_id` 字段之后

8. **system_audited_at**
   - 类型: `DATETIME`
   - 注释: 系统审核时间
   - 位置: 在 `system_auditor_name` 字段之后

### 2.3 新增索引

1. **idx_company_audit_status**
   - 字段: `company_audit_status`
   - 用途: 优化按公司审核状态查询

2. **idx_system_audit_status**
   - 字段: `system_audit_status`
   - 用途: 优化按系统审核状态查询

3. **idx_company_auditor_id**
   - 字段: `company_auditor_id`
   - 用途: 优化按公司审核员ID查询

---

## 三、job_info 表修改

### 3.1 新增字段
- **字段名**: `company_audit_status`
- **类型**: `VARCHAR(20)`
- **注释**: 公司审核状态: pending-待审核 approved-已通过 rejected-已拒绝 modified-需修改
- **位置**: 在 `audit_status` 字段之后
- **用途**: 冗余字段，用于快速查询，避免关联 job_audit_record 表

### 3.2 新增索引
- **索引名**: `idx_company_audit_status`
- **字段**: `company_audit_status`
- **用途**: 优化按公司审核状态查询

---

## 四、hr_audit_record 表新建

### 4.1 表结构

| 字段名 | 类型 | 约束 | 注释 |
|--------|------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 审核记录ID |
| hr_id | BIGINT | NOT NULL | 被审核HR ID |
| user_id | BIGINT | NOT NULL | 被审核HR的用户ID |
| company_id | BIGINT | NOT NULL | 公司ID |
| hr_name | VARCHAR(50) | NOT NULL | HR姓名 |
| audit_status | VARCHAR(20) | NOT NULL | 审核状态: pending-待审核 approved-已通过 rejected-已拒绝 |
| auditor_id | BIGINT | NULL | 审核员ID（公司管理员） |
| auditor_name | VARCHAR(50) | NULL | 审核员姓名 |
| audit_reason | TEXT | NULL | 审核意见 |
| reject_reason | TEXT | NULL | 拒绝原因 |
| audited_at | DATETIME | NULL | 审核时间 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### 4.2 索引

1. **PRIMARY KEY**: `id`
2. **idx_hr_id**: `hr_id` - 按HR ID查询
3. **idx_user_id**: `user_id` - 按用户ID查询
4. **idx_company_id**: `company_id` - 按公司ID查询
5. **idx_audit_status**: `audit_status` - 按审核状态查询
6. **idx_auditor_id**: `auditor_id` - 按审核员ID查询

### 4.3 表属性
- **引擎**: InnoDB
- **字符集**: utf8mb4
- **注释**: HR审核记录表

---

## 五、审核流程说明

### 5.1 岗位审核流程
1. HR创建岗位 → `audit_status = 'draft'`
2. HR提交审核 → `audit_status = 'company_pending'`, `company_audit_status = 'pending'`
3. 公司管理员审核：
   - 通过 → `company_audit_status = 'approved'`, `audit_status = 'system_pending'`, `system_audit_status = 'pending'`
   - 拒绝 → `company_audit_status = 'rejected'`, `audit_status = 'rejected'`
   - 要求修改 → `company_audit_status = 'modified'`, `audit_status = 'modified'`
4. 系统管理员审核（仅审核 `company_audit_status = 'approved'` 的岗位）：
   - 通过 → `system_audit_status = 'approved'`, `audit_status = 'approved'`
   - 拒绝 → `system_audit_status = 'rejected'`, `audit_status = 'rejected'`
   - 要求修改 → `system_audit_status = 'modified'`, `audit_status = 'modified'`

### 5.2 HR审核流程
1. HR注册 → 创建 `hr_audit_record` 记录，`audit_status = 'pending'`
2. 公司管理员审核：
   - 通过 → `audit_status = 'approved'`
   - 拒绝 → `audit_status = 'rejected'`

---

## 六、字段说明

### 6.1 审核状态值
- `pending`: 待审核
- `approved`: 已通过
- `rejected`: 已拒绝
- `modified`: 需修改（仅岗位审核）
- `draft`: 草稿（仅岗位审核）

### 6.2 公司管理员标识
- `is_company_admin = 0`: 普通HR
- `is_company_admin = 1`: 公司管理员

